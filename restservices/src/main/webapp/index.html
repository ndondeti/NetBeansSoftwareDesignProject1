<!DOCTYPE html>

<html>
<head>
<title>Echo Chamber</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
	crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
	crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
	crossorigin="anonymous"></script>
</head>
<body>

	<div class="container">
		<h1>Demo Client</h1>
		<div>
			<input type="text" placeholder="name*" id="studentName" /> <br>
			<input type="text" placeholder="Custom Message" id="messageinput" />
		</div>
		<div>
			<button type="button" onclick="openSocket();">Open</button>
			<button type="button" onclick="send();">Send</button>
			<button type="button" onclick="closeSocket();">Close</button>
		</div>

		<table class="table">
			<tr>
				<td>GetGroups</td>
				<td><textarea id="txt1" class="form-control pull-left" rows="3">
				{
  					"type": "GetGroups"
				}
				</textarea></td>
				<td><button type="button"
						onclick="send(document.getElementById('txt1').value);">Send</button></td>
			</tr>
			<tr>
				<td>JoinGroup</td>
				<td><textarea id="txt2" class="form-control" rows="3">
				{
				  "type": "JoinGroup",
				  "payload": {
				    "groupId": "1"
				  }
				}
				</textarea></td>
				<td><button type="button"
						onclick="send(document.getElementById('txt2').value);">Send</button></td>
			</tr>
			<tr>
				<td>AddStroke</td>
				<td><textarea id="txt3" class="form-control" rows="3">
				{
				  "type": "AddStroke",
				  "payload": {
				    "data": "this is placeholder",
				     "groupId": "1"
				  }
				}</textarea></td>
				<td><button type="button"
						onclick="send(document.getElementById('txt3').value);">Send</button></td>
			</tr>
		</table>
	</div>

	<!-- Server responses get written here -->
	<div id="messages">
		<h3>Messages</h3>
	</div>

	<!-- Script to utilise the WebSocket -->
	<script type="text/javascript">
		var webSocket;
		var messages = document.getElementById("messages");

		function openSocket() {
			// Ensures only one connection is open at a time
			if (webSocket !== undefined
					&& webSocket.readyState !== WebSocket.CLOSED) {
				writeResponse("WebSocket is already opened.");
				return;
			}
			// Create a new instance of the websocket
			webSocket = new WebSocket(
					"ws://localhost:8080/factServer/student/class/"
							+ document.getElementById('studentName').value);

			/**
			 * Binds functions to the listeners for the websocket.
			 */
			webSocket.onopen = function(event) {
				// For reasons I can't determine, onopen gets called twice
				// and the first time event.data is undefined.
				// Leave a comment if you know the answer.
				if (event.data === undefined)
					return;

				writeResponse(event.data);
			};

			webSocket.onmessage = function(event) {
				writeResponse(event.data);
			};

			webSocket.onclose = function(event) {
				writeResponse("Connection closed");
			};
		}

		/**
		 * Sends the value of the text input to the server
		 */
		function send(text) {
			if (text == null)
				text = document.getElementById("messageinput").value;
			console.log(text);
			webSocket.send(text);
		}

		function closeSocket() {
			webSocket.close();
		}

		function writeResponse(text) {
			messages.innerHTML += "<br/>" + text;
		}
	</script>

</body>
</html>